<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.com.bgy.ifc.dao.repair.RepairOrderDao">
  <resultMap id="BaseResultMap" type="cn.com.bgy.ifc.entity.po.repair.RepairOrder">
    <result column="id" jdbcType="BIGINT" property="id" />
    <result column="organization_id" jdbcType="BIGINT" property="organizationId" />
    <result column="computer_room_id" jdbcType="BIGINT" property="computerRoomId" />
    <result column="equipment_id" jdbcType="BIGINT" property="equipmentId" />
    <result column="mcid" jdbcType="INTEGER" property="mcid" />
    <result column="repair_person" jdbcType="VARCHAR" property="repairPerson" />
    <result column="repair_person_call" jdbcType="VARCHAR" property="repairPersonCall" />
    <result column="repair_person_time" jdbcType="TIMESTAMP" property="repairPersonTime" />
    <result column="is_urgent" jdbcType="BIT" property="isUrgent" />
    <result column="state" jdbcType="INTEGER" property="state" />
    <result column="process_person" jdbcType="VARCHAR" property="processPerson" />
    <result column="process_time" jdbcType="TIMESTAMP" property="processTime" />
    <result column="maintaindetail" jdbcType="LONGVARCHAR" property="maintaindetail" />
    <result column="repair_reason" jdbcType="LONGVARCHAR" property="repairReason" />
    <result column="process_remark" jdbcType="LONGVARCHAR" property="processRemark" />
    <result column="order_no" jdbcType="VARCHAR" property="orderNo" />
    <result column="extend_id" jdbcType="INTEGER" property="extendId" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="is_push" jdbcType="BIT" property="isPush" />
    <result column="logic_remove" jdbcType="BIT" property="logicRemove" />
  </resultMap>

  <insert id="insert" parameterType="cn.com.bgy.ifc.entity.po.repair.RepairOrder">
    insert into repair_order (id, organization_id, computer_room_id, 
      equipment_id, mcid, repair_person, 
      repair_person_call, repair_person_time, is_urgent, 
      state, process_person, process_time,
      maintaindetail, repair_reason,
      process_remark, order_no, extend_id,
      create_time, is_push
      logic_remove )
    values (#{id,jdbcType=BIGINT}, #{organizationId,jdbcType=BIGINT}, #{computerRoomId,jdbcType=BIGINT}, 
      #{equipmentId,jdbcType=BIGINT}, #{mcid,jdbcType=INTEGER}, #{repairPerson,jdbcType=VARCHAR}, 
      #{repairPersonCall,jdbcType=VARCHAR}, #{repairPersonTime,jdbcType=TIMESTAMP}, #{isUrgent,jdbcType=BIT}, 
      #{state,jdbcType=INTEGER}, #{processPerson,jdbcType=VARCHAR}, #{processTime,jdbcType=TIMESTAMP},
      #{maintaindetail,jdbcType=LONGVARCHAR}, #{repairReason,jdbcType=LONGVARCHAR},
      #{processRemark,jdbcType=LONGVARCHAR},#{orderNo,jdbcType=VARCHAR},
      #{extendId,jdbcType=INTEGER}, #{createTime,jdbcType=TIMESTAMP},
      #{isPush,jdbcType=BIT},#{logicRemove,jdbcType=BIT} )
  </insert>
  <insert id="insertSelective" parameterType="cn.com.bgy.ifc.entity.po.repair.RepairOrder">
    insert into repair_order
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="organizationId != null">
        organization_id,
      </if>
      <if test="computerRoomId != null">
        computer_room_id,
      </if>
      <if test="equipmentId != null">
        equipment_id,
      </if>
      <if test="mcid != null">
        mcid,
      </if>
      <if test="repairPerson != null">
        repair_person,
      </if>
      <if test="repairPersonCall != null">
        repair_person_call,
      </if>
      <if test="repairPersonTime != null">
        repair_person_time,
      </if>
      <if test="isUrgent != null">
        is_urgent,
      </if>
      <if test="state != null">
        state,
      </if>
      <if test="processPerson != null">
        process_person,
      </if>
      <if test="processTime != null">
        process_time,
      </if>
      <if test="maintaindetail != null">
        maintaindetail,
      </if>
      <if test="repairReason != null">
        repair_reason,
      </if>
      <if test="processRemark != null">
        process_remark,
      </if>
      <if test="orderNo != null">
        order_no,
      </if>
      <if test="extendId != null">
        extend_id,
      </if>
      <if test="createTime != null">
        create_time,
      </if>
      <if test="isPush != null">
        is_push,
      </if>
      <if test="logicRemove != null">
        logic_remove,
      </if>

    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=BIGINT},
      </if>
      <if test="organizationId != null">
        #{organizationId,jdbcType=BIGINT},
      </if>
      <if test="computerRoomId != null">
        #{computerRoomId,jdbcType=BIGINT},
      </if>
      <if test="equipmentId != null">
        #{equipmentId,jdbcType=BIGINT},
      </if>
      <if test="mcid != null">
        #{mcid,jdbcType=INTEGER},
      </if>
      <if test="repairPerson != null">
        #{repairPerson,jdbcType=VARCHAR},
      </if>
      <if test="repairPersonCall != null">
        #{repairPersonCall,jdbcType=VARCHAR},
      </if>
      <if test="repairPersonTime != null">
        #{repairPersonTime,jdbcType=TIMESTAMP},
      </if>
      <if test="isUrgent != null">
        #{isUrgent,jdbcType=BIT},
      </if>
      <if test="state != null">
        #{state,jdbcType=INTEGER},
      </if>
      <if test="processPerson != null">
        #{processPerson,jdbcType=VARCHAR},
      </if>
      <if test="processTime != null">
        #{processTime,jdbcType=TIMESTAMP},
      </if>
      <if test="maintaindetail != null">
        #{maintaindetail,jdbcType=LONGVARCHAR},
      </if>
      <if test="repairReason != null">
        #{repairReason,jdbcType=LONGVARCHAR},
      </if>
      <if test="processRemark != null">
        #{processRemark,jdbcType=LONGVARCHAR},
      </if>
      <if test="orderNo != null">
        #{orderNo,jdbcType=VARCHAR},
      </if>
      <if test="extendId != null">
        #{extendId,jdbcType=INTEGER},
      </if>
      <if test="createTime != null">
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="isPush != null">
        #{isPush,jdbcType=BIT},
      </if>
      <if test="logicRemove != null">
        #{logicRemove,jdbcType=BIT},
      </if>


    </trim>
  </insert>

  <select id="queryListRepairOrder" resultType="java.util.Map" parameterType="cn.com.bgy.ifc.entity.vo.task.RegionAndBrandVO">
        SELECT o.id as id,v.`name` as name,
        CONCAT(v.regionName,v.projectName,v.courtName,v.streetName,v.buildingName) AS address,
        o.maintaindetail as maintaindetail,o.repair_person as personName,
        o.repair_person_time as repairTime,o.is_urgent as isUrgent,
        o.state as state,o.process_time as processTime
        FROM repair_order o
        LEFT JOIN equipment_info_v v ON o.equipment_id = v.id
        <where>
          <if test="regionId != null and regionId !='' ">
            AND v.regionId = #{regionId,jdbcType=BIGINT},
          </if>
          <if test="projectId != null and projectId !='' ">
            AND v.projectId = #{projectId,jdbcType=BIGINT},
          </if>
          <if test="typeId != null and typeId !='' ">
            AND v.typeId = #{typeId,jdbcType=BIGINT},
          </if>
          <if test="versionId != null and versionId !='' ">
            AND v.versionId = #{versionId,jdbcType=BIGINT},
          </if>
          <if test="brandId != null and brandId !='' ">
            AND v.brandId = #{brandId,jdbcType=BIGINT},
          </if>
          <if test="state !null and state !='' ">
            AND o.state = #{state,jdbcType=INTEGER},
          </if>
          <if test="keyword != null and keyword !='' ">
            AND ( o.maintaindetail like concat('%',#{keyword},'%') OR  o.repair_person like concat('%',#{keyword},'%'))
          </if>
          AND o.logic_remove = 0
        </where>

  </select>
  <select id="queryRepairOrderById" parameterType="java.lang.Long" resultType="java.util.Map">

  </select>

  <update id="deleteRepairOrder" parameterType="java.util.List">
    UPDATE  repair_order set logic_remove =1  where id IN
    <foreach collection="list" index="index" item="id" open="(" separator="," close=")">
      #{id}
    </foreach>
  </update>
  <select id="queryRepairOrderIsDelete" parameterType="java.util.List" resultType="java.lang.Long">
        SELECT id FROM repair_order WHERE id IN
          <foreach collection="list" index="index" item="id" open="(" separator="," close=")">
                #{id}
          </foreach>
          AND logic_remove = 0
          AND is_push = 0
          AND state in(0,3,4)
  </select>

  <select id="queryRepairOrderIsUpdate" parameterType="java.lang.Long">
        SELECT id FROM repair_order WHERE
        id =#{id}
        AND logic_remove = 0
        AND is_push = 0
        AND state =0
  </select>
  <update id="updateRepairOrder" parameterType="cn.com.bgy.ifc.entity.po.repair.RepairOrder">
    UPDATE equipment_info
    <set>
      <if test="mcid != null">
        mcid =#{mcid,jdbcType=INTEGER},
      </if>
      <if test="maintaindetail != null">
        maintaindetail=#{maintaindetail,jdbcType=LONGVARCHAR},
      </if>
      <if test="repairPerson != null">
        repair_person=#{repairPerson,jdbcType=VARCHAR},
      </if>
      <if test="repair_person_time != null">
        repair_person_time=#{repairPersonTime,jdbcType=TIMESTAMP},
      </if>
      <if test="is_urgent != null">
        is_urgent=#{isUrgent,jdbcType=BIT},
      </if>
      <if test="state != null">
        state=#{state,jdbcType=BIGINT},
      </if>
      <if test="state != null">
        state=#{state,jdbcType=BIGINT},
      </if>
      <if test="create_time != null">
        create_time=#{createTime,jdbcType=TIMESTAMP},
      </if>
    </set>
    WHERE id
    = #{id}
  </update>
</mapper>