<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.com.bgy.ifc.dao.equipment.EquipmentInfoDao">
    <resultMap id="BaseResultMap" type="cn.com.bgy.ifc.entity.po.equipment.EquipmentInfo">
        <result column="id" jdbcType="BIGINT" property="id"/>
        <result column="name" jdbcType="VARCHAR" property="name"/>
        <result column="input_code" jdbcType="VARCHAR" property="inputCode"/>
        <result column="machine_room_id" jdbcType="BIGINT" property="machineRoomId"/>
        <result column="version_id" jdbcType="BIGINT" property="versionId"/>
        <result column="brand_id" jdbcType="BIGINT" property="brandId"/>
        <result column="type_id" jdbcType="BIGINT" property="typeId"/>
        <result column="keep_years" jdbcType="INTEGER" property="keepYears"/>
        <result column="in_work_time" jdbcType="TIMESTAMP" property="inWorkTime"/>
        <result column="important" jdbcType="INTEGER" property="important"/>
        <result column="status" jdbcType="INTEGER" property="status"/>
        <result column="localtion_code" jdbcType="VARCHAR" property="localtionCode"/>
        <result column="simple_code" jdbcType="VARCHAR" property="simpleCode"/>
        <result column="api_code" jdbcType="VARCHAR" property="apiCode"/>
        <result column="logic_remove" jdbcType="BIT" property="logicRemove"/>
        <result column="description" jdbcType="LONGVARCHAR" property="description"/>
    </resultMap>
    <sql id="Blob_Column_List">
    description
  </sql>
  <insert id="insert" parameterType="cn.com.bgy.ifc.entity.po.equipment.EquipmentInfo">
    insert into equipment_info (id, name, input_code, 
      version_id, brand_id, type_id, 
      keep_years, in_work_time, important,
      status, localtion_code, simple_code, 
      api_code, description,logic_remove)
    values (#{id,jdbcType=BIGINT}, #{name,jdbcType=VARCHAR}, #{inputCode,jdbcType=BIGINT}, 
      #{versionId,jdbcType=BIGINT}, #{brandId,jdbcType=BIGINT}, #{typeId,jdbcType=BIGINT}, 
      #{keepYears,jdbcType=INTEGER}, #{inWorkTime,jdbcType=TIMESTAMP}, #{important,jdbcType=INTEGER}, 
      #{status,jdbcType=INTEGER}, #{localtionCode,jdbcType=VARCHAR}, #{simpleCode,jdbcType=VARCHAR}, 
      #{apiCode,jdbcType=VARCHAR}, #{description,jdbcType=LONGVARCHAR}, #{logicRemove,jdbcType=BIT})
  </insert>
    <insert id="insertSelective" parameterType="cn.com.bgy.ifc.entity.po.equipment.EquipmentInfo">
        insert into equipment_info
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>
            <if test="name != null">
                name,
            </if>
            <if test="inputCode != null">
                input_code,
            </if>
            <if test="machineRoomId != null">
                machine_room_id,
            </if>
            <if test="versionId != null">
                version_id,
            </if>
            <if test="brandId != null">
                brand_id,
            </if>
            <if test="typeId != null">
                type_id,
            </if>
            <if test="keepYears != null">
                keep_years,
            </if>
            <if test="inWorkTime != null">
                in_work_time,
            </if>
            <if test="important != null">
                important,
            </if>
            <if test="status != null">
                status,
            </if>
            <if test="localtionCode != null">
                localtion_code,
            </if>
            <if test="simpleCode != null">
                simple_code,
            </if>
            <if test="apiCode != null">
                api_code,
            </if>
            <if test="description != null">
                description,
            </if>
            <if test="logicRemove != null">
                logic_remove,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=BIGINT},
            </if>
            <if test="name != null">
                #{name,jdbcType=VARCHAR},
            </if>
            <if test="inputCode != null">
                #{inputCode,jdbcType=VARCHAR},
            </if>
            <if test="machineRoomId != null">
                #{machineRoomId,jdbcType=BIGINT},
            </if>
            <if test="versionId != null">
                #{versionId,jdbcType=BIGINT},
            </if>
            <if test="brandId != null">
                #{brandId,jdbcType=BIGINT},
            </if>
            <if test="typeId != null">
                #{typeId,jdbcType=BIGINT},
            </if>
            <if test="keepYears != null">
                #{keepYears,jdbcType=INTEGER},
            </if>
            <if test="inWorkTime != null">
                #{inWorkTime,jdbcType=TIMESTAMP},
            </if>
            <if test="important != null">
                #{important,jdbcType=INTEGER},
            </if>
            <if test="status != null">
                #{status,jdbcType=INTEGER},
            </if>
            <if test="localtionCode != null">
                #{localtionCode,jdbcType=VARCHAR},
            </if>
            <if test="simpleCode != null">
                #{simpleCode,jdbcType=VARCHAR},
            </if>
            <if test="apiCode != null">
                #{apiCode,jdbcType=VARCHAR},
            </if>
            <if test="description != null">
                #{description,jdbcType=LONGVARCHAR},
            </if>
            <if test="logicRemove != null">
                #{logicRemove,jdbcType=BIT},
            </if>
        </trim>
    </insert>
    <update id="updateSelective" parameterType="cn.com.bgy.ifc.entity.po.equipment.EquipmentInfo">
        UPDATE equipment_info
        <set>
            <if test="name != null">
                name=#{name,jdbcType=VARCHAR},
            </if>
            <if test="inputCode != null">
                input_code=#{inputCode,jdbcType=VARCHAR},
            </if>
            <if test="machineRoomId != null">
                machine_room_id=#{machineRoomId,jdbcType=BIGINT},
            </if>
            <if test="versionId != null">
                version_id= #{versionId,jdbcType=BIGINT},
            </if>
            <if test="brandId != null">
                brand_id=#{brandId,jdbcType=BIGINT},
            </if>
            <if test="typeId != null">
                type_id= #{typeId,jdbcType=BIGINT},
            </if>
            <if test="keepYears != null">
                keep_years=#{keepYears,jdbcType=INTEGER},
            </if>
            <if test="inWorkTime != null">
                in_work_time=#{inWorkTime,jdbcType=TIMESTAMP},
            </if>
            <if test="important != null">
                important=#{important,jdbcType=INTEGER},
            </if>
            <if test="status != null">
                status=#{status,jdbcType=INTEGER},
            </if>
            <if test="localtionCode != null">
                localtion_code=#{localtionCode,jdbcType=VARCHAR},
            </if>
            <if test="simpleCode != null">
                simple_code= #{simpleCode,jdbcType=VARCHAR},
            </if>
            <if test="apiCode != null">
                api_code= #{apiCode,jdbcType=VARCHAR},
            </if>
            <if test="description != null">
                description= #{description,jdbcType=LONGVARCHAR},
            </if>
            <if test="logicRemove != null">logic_remove =#{logicRemove},</if>
        </set>
        WHERE id
        = #{id}
    </update>
    <update id="deleteEquipmentInfo" parameterType="java.util.List">
        UPDATE  equipment_info set logic_remove =1  where id IN
        <foreach collection="list" index="index" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </update>

    <select id="queryListEquipmentInfo"  resultType="java.util.Map" parameterType="cn.com.bgy.ifc.entity.vo.task.RegionAndBrandVO">
        SELECT
        ei.id as id,
        ri.id as regionId,
        rp.id as projectId,
        rc.id as courtId,
        rs.id as streetId,
        rb.id as buildingId,
        CONCAT(ri.`name`,rp.`name`,rc.`name`,rs.`name`,rb.`name`) as address,
        ei.`name` as name,
        ei.input_code as inputCode,
        et.id as typeId,et.`name` as typeName,
        eb.id as brandId,eb.`name` as brandName,
        ev.id as versionId,ev.`name` as versionName,
        ei.`status` as  `status`
        FROM ((((((((equipment_info ei
        LEFT JOIN region_computer_room rr ON ei.machine_room_id = rr.id)
        LEFT JOIN region_info ri ON rr.region_id = ri.id)
        LEFT JOIN region_project rp ON rr.project_id = rp.id)
        LEFT JOIN region_court rc ON rr.court_id = rc.id)
        LEFT JOIN region_street rs ON rr.street_id = rs.id)
        LEFT JOIN region_building rb ON rr.building_id = rb.id)
        LEFT JOIN equipment_type et ON ei.type_id = et.id)
        LEFT JOIN equipment_brand eb ON ei.brand_id = eb.id)
        LEFT JOIN equipment_version ev ON ei.version_id = ev.id
        <where>
            <if test="regionId != null and regionId !='' ">
                AND ri.id = #{regionId,jdbcType=BIGINT}
            </if>
            <if test="projectId != null and projectId !='' ">
                AND  rp.id = #{projectId,jdbcType=BIGINT}
            </if>
            <if test="courtId != null and courtId !='' ">
                AND  rc.id = #{courtId,jdbcType=BIGINT}
            </if>

            <if test="typeId != null and typeId !='' ">
                AND et.id = #{typeId,jdbcType=BIGINT}
            </if>
            <if test="brandId != null and brandId !='' ">
                AND eb.id = #{brandId,jdbcType=BIGINT}
            </if>
            <if test="versionId != null and versionId !='' ">
                AND ev.id = #{versionId,jdbcType=BIGINT}
            </if>
            <if test="keyword != null and keyword !='' ">
                AND (rs.`name` LIKE concat('%',#{keyword},'%') OR rb.`name` LIKE concat('%',#{keyword},'%') OR et.`name` LIKE concat('%',#{keyword},'%'))
            </if>

            AND ei.logic_remove = 0
            <!--
            AND rr.logic_remove = 0
            AND rp.logic_remove = 0
            AND rs.logic_remove = 0
            AND rb.logic_remove = 0
            AND et.logic_remove = 0
            AND eb.`status` in(0,1)
            AND ev.logic_remove = 0
             -->
        </where>
    </select>
    <select id="queryEquipmentInfoById" resultType="java.util.Map" parameterType="java.lang.Long">


         SELECT
        ei.id as id,ei.`name` as name,
        ri.id as regionId,ri.`name` as regionName,
        rp.id as projectId,rp.`name` as projectName,
        rc.id as courtId,rc.`name` as courtName,
        rs.id as streetId,rs.`name` as streetName,
        rb.id as buildingId,rb.`name` as buildingName,
        ei.input_code as inputCode,
        et.id as typeId,et.`name` as typeName,
        eb.id as brandId,eb.`name` as brandName,
        ev.id as versionId,ev.`name` as versionName,
        ei.inputCode as inputCode,
        ei.keep_years as keepYears,ei.in_work_time as workTime,
        ei.important as important,ei.localtion_code as localtionCode,
        ei.simple_code as simpleCode,ei.api_code as apiCode,
        ei.`status` as  `status`
        FROM ((((((((equipment_info ei
        LEFT JOIN region_computer_room rr ON ei.machine_room_id = rr.id)
        LEFT JOIN region_info ri ON rr.region_id = ri.id)
        LEFT JOIN region_project rp ON rr.project_id = rp.id)
        LEFT JOIN region_court rc ON rr.court_id = rc.id)
        LEFT JOIN region_street rs ON rr.street_id = rs.id)
        LEFT JOIN region_building rb ON rr.building_id = rb.id)
        LEFT JOIN equipment_type et ON ei.type_id = et.id)
        LEFT JOIN equipment_brand eb ON ei.brand_id = eb.id)
        LEFT JOIN equipment_version ev ON ei.version_id = ev.id
        WHERE i.id = #{id,jdbcType=BIGINT}
    </select>

    <select id="queryRoomIdByEquipmentId" parameterType="java.lang.Long" resultType="java.lang.Long">
        SELECT machine_room_id FROM equipment_info  WHERE id = #{id} and  logic_remove = 0
    </select>
</mapper>